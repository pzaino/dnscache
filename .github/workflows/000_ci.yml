---
    name: CI
    
    permissions:
      contents: read
    
    on:
      push:
        branches:
          - main
          - develop
      pull_request:
    
    jobs:
      test:
        name: Test on ${{ matrix.os }}
        runs-on: ${{ matrix.os }}
    
        strategy:
          fail-fast: false
          matrix:
            os: [ubuntu-latest, macos-latest, windows-latest]
    
        steps:
          - name: Checkout
            uses: actions/checkout@v4
    
          - name: Install Rust (from rust-toolchain file)
            uses: dtolnay/rust-toolchain@stable
    
          - name: Cache cargo registry + target
            uses: Swatinem/rust-cache@v2
    
          - name: Format check
            run: cargo fmt --all -- --check
    
          - name: Clippy (lint)
            run: cargo clippy --all-targets --all-features -- -D warnings
    
          - name: Build
            run: cargo build --all-targets --all-features
    
          - name: Run tests
            run: cargo test --all --all-features --verbose
    